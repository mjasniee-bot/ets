<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<title>KTMB Command Center Level 4 Professional</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>

body{
margin:0;
font-family:Segoe UI;
background:#0b1220;
color:white;
overflow:hidden;
}

#map{
height:100vh;
width:100%;
}

/* ===== LEFT PANEL ===== */

#trainPanel{

position:absolute;
top:10px;
left:10px;
width:260px;
max-height:90vh;
background:rgba(15,23,42,0.95);
border-radius:10px;
padding:10px;
overflow:auto;
box-shadow:0 0 15px rgba(0,255,255,0.2);
transition:0.3s;
}

#trainPanel.collapsed{

transform:translateX(-230px);

}

#togglePanel{

position:absolute;
top:10px;
left:280px;
background:#00ffff;
color:black;
border:none;
padding:6px 10px;
border-radius:6px;
cursor:pointer;
font-weight:bold;

}

.trainItem{

padding:6px;
margin:4px 0;
border-radius:6px;
font-size:13px;
display:flex;
justify-content:space-between;
align-items:center;

}

.moving{
background:rgba(0,255,150,0.2);
}

.stopped{
background:rgba(255,200,0,0.2);
}

.offline{
background:rgba(255,0,0,0.2);
}

/* ===== DOT TRAIN ICON ===== */

.trainDot{

width:12px;
height:12px;
border-radius:50%;
display:inline-block;
margin-right:5px;

}

.dotMoving{

background:#00ff9d;
box-shadow:0 0 10px #00ff9d;
animation:blink 1s infinite;

}

.dotStopped{

background:#ffaa00;

}

.dotOffline{

background:red;

}

@keyframes blink{

0%{opacity:1;}
50%{opacity:0.2;}
100%{opacity:1;}

}

/* ===== NAME LABEL ===== */

.trainLabel{

color:#00ffff;
font-size:12px;
font-weight:bold;
text-shadow:0 0 3px black;

}

/* ===== STATS PANEL ===== */

#stats{

position:absolute;
top:10px;
right:10px;
background:rgba(15,23,42,0.95);
padding:10px;
border-radius:10px;
font-size:13px;
}

</style>

</head>
<body>

<div id="map"></div>

<div id="trainPanel">

<h3>ðŸš† Train List</h3>

<div id="trainList"></div>

</div>

<button id="togglePanel">â˜°</button>

<div id="stats">

Active: <span id="activeCount">0</span><br>
Stopped: <span id="stopCount">0</span><br>
Offline: <span id="offlineCount">0</span><br>
Last Update: <span id="lastUpdate">--</span>

</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>

// ===== MAP =====

var map = L.map('map').setView([3.139,101.686],7);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
maxZoom:18
}).addTo(map);


// ===== TRAIN DATA SIMULATION =====

var trains = [

{name:"ETS 9210",lat:3.139,lon:101.686,speed:90,lastMove:Date.now()},
{name:"Komuter 2304",lat:3.073,lon:101.518,speed:0,lastMove:Date.now()-40000},
{name:"ETS 9301",lat:4.597,lon:101.090,speed:120,lastMove:Date.now()},
{name:"Komuter 2215",lat:1.492,lon:103.741,speed:0,lastMove:Date.now()-120000},

];


var markers={};
var labels={};


// ===== CREATE MARKERS =====

function createMarkers(){

trains.forEach(train=>{

var dotClass = getDotClass(train);

var icon = L.divIcon({
className:'',
html:`<div class="trainDot ${dotClass}"></div>`
});

var marker = L.marker([train.lat,train.lon],{icon}).addTo(map);

marker.bindPopup(()=>`
<b>${train.name}</b><br>
Speed: ${train.speed} km/h<br>
Lat: ${train.lat.toFixed(5)}<br>
Lon: ${train.lon.toFixed(5)}
`);

var label = L.marker([train.lat,train.lon],{

icon:L.divIcon({

className:'trainLabel',
html:train.name

})

}).addTo(map);

markers[train.name]=marker;
labels[train.name]=label;

});

}


// ===== STATUS DETECTION =====

function getStatus(train){

var diff=(Date.now()-train.lastMove)/1000;

if(diff>60) return "offline";
if(train.speed==0) return "stopped";

return "moving";

}


function getDotClass(train){

var status=getStatus(train);

if(status=="moving") return "dotMoving";
if(status=="stopped") return "dotStopped";
return "dotOffline";

}


// ===== UPDATE UI =====

function updateUI(){

var active=0;
var stop=0;
var offline=0;

var listHTML="";

trains.forEach(train=>{

var status=getStatus(train);

if(status=="moving") active++;
else if(status=="stopped") stop++;
else offline++;

listHTML+=`

<div class="trainItem ${status}">
<span>
<div class="trainDot ${getDotClass(train)}"></div>
${train.name}
</span>

<span>${status}</span>

</div>

`;

});

document.getElementById("trainList").innerHTML=listHTML;

document.getElementById("activeCount").innerText=active;
document.getElementById("stopCount").innerText=stop;
document.getElementById("offlineCount").innerText=offline;
document.getElementById("lastUpdate").innerText=new Date().toLocaleTimeString();

}


// ===== SIMULATE MOVEMENT =====

function simulate(){

trains.forEach(train=>{

if(train.speed>0){

train.lat+=((Math.random()-0.5)/100);
train.lon+=((Math.random()-0.5)/100);

train.lastMove=Date.now();

}

var marker=markers[train.name];
var label=labels[train.name];

marker.setLatLng([train.lat,train.lon]);
label.setLatLng([train.lat,train.lon]);

marker.setIcon(L.divIcon({

className:'',
html:`<div class="trainDot ${getDotClass(train)}"></div>`

}));

});

updateUI();

}


// ===== PANEL TOGGLE =====

document.getElementById("togglePanel").onclick=function(){

var panel=document.getElementById("trainPanel");

panel.classList.toggle("collapsed");

};


// ===== START =====

createMarkers();
updateUI();

setInterval(simulate,3000);

</script>

</body>
</html>
